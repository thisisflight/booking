## Сервис для поиска и бронирования отелей

[Ссылка на сайт](http://34.88.123.205/)

Реализовано при помощи фреймворка Django с подключением дополнительных библиотек,
таких как django-cleanup, django-allauth, psycopg2, sentry и других (полный список в файле [requirements](https://github.com/thisisflight/booking/blob/main/requirements.txt)), <br> 
развернуто на Ubuntu 20.04, веб-сервер nginx<br>


## Функционал сайта:

1) Регистрация и вход пользователей как при помощи встроенного функционала фреймворка, так и при помощи социальной сети Вконтакте
2) Поиск и фильтрация отелей, пагинация в том числе отфильтрованных результатов, возможность увидеть на странице отеля при заданных дате заезда и выезда наличие свободных номеров
3) Детальная страница отеля с перечнем его свойств, номерным фондом и возможностью забронировать при наличии номер
4) Личный кабинет с ролевым распределением доступа - dashboard и создание отелей и номеров для админов и контент-менеджеров, персональная информация для всех пользователей
5) Сброс и восстановление пароля пользователя по email через SMTP

## [Стартовая страница](http://34.88.123.205/)
### Форма для ввода дат
После ввода дат осуществляется редирект на страницу со списком отелей, введённые даты сохранятся в ключ сессии и будут показаны на странице заинтересовавшего отеля.<br>
Если введена только дата прибытия, для даты отъезда будет подставлен следующий день.<br>
Если введена только дата отъезда, для даты приезда будет подставлен предыдущий день.<br>
Если дата прибытия позже даты отъезда, для даты отъезда будет подставлен следующий после даты прибытия день.<br>

### Пример работы формы при вводе даты приезда позднее даты отъезда:
![главная список стран переход](https://user-images.githubusercontent.com/86616350/164753155-0369ca6c-836c-42b6-b7d4-e302dc34d30f.gif)


### Вывод стран с отелями
Выводится три страны, отсортированные по id в обратном порядке, при нажатии на кнопку "Посмотреть" осуществляется переход на страницу отелей, где они отфильтрованы по выбранной стране.<br><br>
![главная список стран переход](https://user-images.githubusercontent.com/86616350/164698187-630aaea5-0121-442c-8a16-2d2b8e52c132.gif)

### Вывод отелей
Выводится три отеля, имеющие наиболее дешёвые номера (сортировка кверисета в порядке возрастания по добавленному полю)<br>
Отображаются средняя оценка отеля, количество отзывов (слово 'отзыв' склоняется в зависимости от количества)<br><br>
![главная отели](https://user-images.githubusercontent.com/86616350/164753819-35dd9928-e18d-45c6-b15d-f0d047fa0f6e.png)

### Вывод отзывов
Выводятся три последних отзыва на отели, показаны аватарки пользовтелей (в случае отсутствия - дефолтная картинка), имя фамилия пользователя, ссылка на отель, дата и текст комментария<br>

## [Страница списка отелей](http://34.88.123.205/hotels/)
1. Страница представлена фильтром отелей и их списком.<br>
2. Принцип работы фильтра интуитивно понятен каждому пользователю Интернета.<br>
3. Работа с датами аналогична той, что реализована на главной странице.<br>
4. Если цена 'от' указана выше, чем 'после', то параметры цены меняются местами.<br>
5. По умолчанию для фильтра работает радиоселект 'Сортировать по цене, начиная от минимальной'<br>
6. Постраничная пагинация предусматривает работу как с чистыми, так и с отфильтрованными данными.<br>

## Страница отеля

Отображается вся информация об отеле в наглядном виде, а также наличие мест на указанные даты (или информацию о том, что даты необходимо указать), все номера данного отеля, рейтинг отеля и отзывы. В описание отеля можно добавить готовую HTML-разметку.<br>
### Особенности отображения наличия мест:<br>
- когда даты не были введены:<br><br>
![дат нет](https://user-images.githubusercontent.com/86616350/164771284-7d1d0928-1a31-46e3-b4f9-02e95f94843b.png)
- когда даты введены, но эти дни уже прошли:<br><br>
![даты прошли](https://user-images.githubusercontent.com/86616350/164772223-d6af387d-cd14-4700-b75b-8de1926bcaa9.png)
- когда пользователь выбирает 'Указать даты поездки' напротив интересующего номера, выводится всплывающее окно с формой ввода дат, функционал формы ввода полностью соответствует аналогичным формам ввода дат на других страницах:<br><br>
![выбрать даты в окне](https://user-images.githubusercontent.com/86616350/164772493-8ad02ea7-b2c3-4868-b563-5daa1f5ced46.png)
- когда есть возможность забронировать любой номер:<br>
![бронь доступна](https://user-images.githubusercontent.com/86616350/164773323-5ecd24d8-2173-4628-b05a-cda35c517881.png)
- когда один из номеров занят:<br>
![одно место занято](https://user-images.githubusercontent.com/86616350/164773442-d1482866-6ca4-4801-a123-90c2d04f1045.png)
- когда заняты все номера:<br>
![мест нет](https://user-images.githubusercontent.com/86616350/164773508-c4a9d116-2471-4c43-954f-89f8c2ff9318.png)
<br>
Один пользователь может оставить только один отзыв отелю и только при условии, если он его бронировал.

## Вход на сайт и регистрация

### Регистрация

В коде предусмотрено два бэкенда регистрации - от Django и django-allauth.<br>
Валидации формы регистрации: (ошибка поля email отображается в non_field_errors)<br>
После регистрации при помощи сигнала post_save пользователь добавляется в группу ролей 'Пользователь', а также получает привязанную модель профиля.<br>
![валидация регистрации](https://user-images.githubusercontent.com/86616350/164777336-da4474d1-d920-480c-ad25-c20f43e342e9.png)

### Логин

Вход осуществляется как посредствои ввода логина, так и по email посредством django-allauth. <br>
Если пользователь связал аккаунт с социальной сетью Вконтакте, вход осуществляется мгновенно: <br>
Также реализована возможность восстановления пароля через email.<br><br>
![мгновенный вход](https://user-images.githubusercontent.com/86616350/164779713-d7a4327f-83ba-45a2-b1f5-b310e0d3e820.gif)

## Личный кабинет

Весь функционал личного кабинета доступен только зарегистрированным пользователям, помимо этого отдельный функционал доступен по отдельности группам Администратор, Контент-менеджер и Пользователь.

### Дашбоард

Дашбоард доступен только группам Администратор и Контент-менеджер, группа Пользователь получает 403 ответ от сервера.<br>
Отображение дашбоарда для группы Администратор (отображается общая информация о количестве пользователей, бронирований и отзывов, а также список отелей и общая информация о них):<br><br>
![дашборд для админа](https://user-images.githubusercontent.com/86616350/164781782-0e086f91-a783-4f47-a35c-44250b81f2f3.png)<br><br>
Отображение дашбоарда для группы Контент-менеджер (отображается только информация об отелях):
![дашборд контент менеджер](https://user-images.githubusercontent.com/86616350/164781929-3a15715a-df48-48ea-a16a-a08c8bf68c29.png)
Из дашбоарда можно перейти в защищённый режим создания отелей и номеров.<br>
Создание номеров осуществляется при помощи формсета из двух форм, предусмотрено отображение ошибки валидации при отправке пустого формсета.<br> 
После создания номеров осуществляется редирект на страницу обновления созданного номера, где можно при необходимости исправить информацию или перейти внизу по ссылкам на обновление только что созданных номеров. <br><br>
![создание отелей и номеров](https://user-images.githubusercontent.com/86616350/164788009-62106f88-81a2-4f95-a71a-e6085ebef6cc.gif)

### Профайл

Реализован при помощи UpdateView, в целях демонстрации функционала оставлена возможность для пользователей самостоятельно переключаться между ролями, валидируется смена логина и email, а также реализована возможность сменить пароль из личного кабинета.

### Бронирования

Для групп Администратор и Контент-менеджер отображаются все бронирования и оценки отелям от текущего пользователя, если они есть<br>
![список броней админ](https://user-images.githubusercontent.com/86616350/164786627-1c2dfe42-ad4a-4884-b660-c19fc5fe98ab.png)
Для группы Пользователь отображаются бронирования пользователя и его оценки отелям, если есть, а также возможность отменить бронирование, если даты ещё не наступили<br><br>
![список бронирований пользователь](https://user-images.githubusercontent.com/86616350/164791182-e98f0b35-873e-4973-a910-bb3173a021cd.gif)

### Отзывы

Для групп Администратор и Контент-менеджер отображаются все отзывы на сайте.<br>
Для группы Пользователь отображаются отзывы текущего пользователя.

### Страницы ответов 403, 404, ошибки сервера 500

Реализованы с помощью встроенного функционала Django по рендерингу страниц ошибок и ограничения доступа.<br>
Страница 403: <br>
![страница 403](https://user-images.githubusercontent.com/86616350/164793746-450f0a9b-5d07-4f79-bdf6-25eaac4e149d.png)
Для страниц 404 и 500 отличается лишь содержание сообщения.
